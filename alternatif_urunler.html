<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <title>ŞENTÜRK – Diğer Markalar Fiyat Listesi</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- SheetJS -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

  <style>
    :root{
      --bg:#ececec;
      --paper:#ffffff;
      --paperBorder:#cfcfcf;
      --shadow: rgba(0,0,0,0.18);

      --text:#222;
      --muted:#6b7280;

      --btn:#111827;
      --btnText:#fff;
      --btn2:#f3f4f6;
      --btn2Text:#111827;

      --tableBorder:#dedede;
      --thead:#f2f2f2;

      --sectionHead:#111827;
      --sectionHeadText:#f9fafb;
      --rowAlt:#f7f7f7;
    }

    *{box-sizing:border-box;margin:0;padding:0}
    body{
      font-family: system-ui,-apple-system,"Segoe UI",sans-serif;
      background: var(--bg);
      color: var(--text);
      padding: 18px;
    }

    .paper{
      max-width: 1100px;
      margin: 0 auto;
      background: var(--paper);
      border: 1px solid var(--paperBorder);
      box-shadow: 0 8px 24px var(--shadow);
      padding: 22px 26px 28px;
    }

    .topbar{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:16px;
      margin-bottom: 10px;
    }

    .logoSide{
      display:flex;
      align-items:center;
      gap:10px;
      min-width: 220px;
    }
    .logoSide.right{
      justify-content:flex-end;
      text-align:right;
    }

    .logoSide img{
      height: 54px;
      width:auto;
      object-fit:contain;
    }

    .titleWrap{
      flex: 1;
      text-align:center;
      border-top: 2px solid #333;
      padding-top: 10px;
      margin: 0 10px;
    }

    .titleWrap h1{
      font-size: 18px;
      font-weight: 800;
      letter-spacing: 0.06em;
    }

    .titleWrap .sub{
      margin-top: 6px;
      font-size: 12px;
      color: var(--muted);
    }

    .controlsRow{
      display:flex;
      align-items:center;
      gap:10px;
      flex-wrap:wrap;
      margin-top: 14px;
      margin-bottom: 12px;
    }

    input[type="file"]{ font-size: 12px; }

    .search{
      padding: 7px 12px;
      border: 1px solid #cfcfcf;
      border-radius: 6px;
      min-width: 260px;
      font-size: 13px;
    }

    .btn{
      border: 1px solid #111827;
      border-radius: 6px;
      padding: 7px 12px;
      cursor:pointer;
      font-size: 13px;
      white-space:nowrap;
    }

    .btn-dark{ background: var(--btn); color: var(--btnText); }
    .btn-light{ background: var(--btn2); color: var(--btn2Text); border-color: #cfcfcf; }

    .hint{
      font-size: 12px;
      color: var(--muted);
      margin: 8px 0 14px;
      line-height: 1.4;
    }

    .section{
      margin-top: 16px;
      page-break-inside: avoid;
    }

    .sectionHead{
      background: var(--sectionHead);
      color: var(--sectionHeadText);
      padding: 7px 10px;
      border-radius: 6px 6px 0 0;
      display:flex;
      justify-content:space-between;
      align-items:center;
      font-weight: 700;
      font-size: 13px;
      gap: 10px;
    }

    .sectionLeft{
      display:flex;
      align-items:center;
      gap:10px;
    }

    .brandLogo{
      width: 28px;
      height: 28px;
      border-radius: 6px;
      background: rgba(255,255,255,0.1);
      display:flex;
      align-items:center;
      justify-content:center;
      overflow:hidden;
      border: 1px solid rgba(255,255,255,0.2);
    }

    .brandLogo img{
      width: 100%;
      height: 100%;
      object-fit: contain;
      padding: 3px;
    }

    .brandBadge{
      width: 28px;
      height: 28px;
      border-radius: 6px;
      background: rgba(255,255,255,0.2);
      display:flex;
      align-items:center;
      justify-content:center;
      font-weight: 800;
    }

    .tableWrap{
      border: 1px solid var(--tableBorder);
      border-top: none;
      overflow:auto;
    }

    table{
      width:100%;
      border-collapse:collapse;
      font-size: 13px;
      min-width: 820px;
    }

    th, td{
      border: 1px solid var(--tableBorder);
      padding: 6px 8px;
      white-space: nowrap;
      vertical-align: top;
    }

    th{
      background: var(--thead);
      font-size: 12px;
      font-weight: 700;
      position: sticky;
      top: 0;
    }

    tbody tr:nth-child(even){ background: var(--rowAlt); }
    .hidden{ display:none !important; }

    @media print{
      body{ background:#fff; padding:0 }
      .paper{ box-shadow:none; border:none; padding:10mm; }
      .controlsRow,.hint{ display:none }
      table{ min-width:auto }
      th{ position:static }
      td,th{ white-space:normal }
    }
  </style>
</head>

<body>
<div class="paper">

  <div class="topbar">
    <div class="logoSide">
      <img src="assets/images/senturk_logo.png" alt="Şentürk">
    </div>

    <div class="titleWrap">
      <h1>DİĞER MARKALAR FİYAT LİSTESİ</h1>
      <div class="sub">Excel sheet bazlı · otomatik yüklü</div>
    </div>

    <div class="logoSide right">
      <img src="assets/images/marshall_logo.png" alt="" onerror="this.style.display='none'">
    </div>
  </div>

  <div class="controlsRow">
    <input type="file" id="file" accept=".xlsx,.xls">
    <input class="search" id="search" placeholder="Ürün / ambalaj / fiyat ara...">
    <button class="btn btn-light" id="clear">Temizle</button>
    <button class="btn btn-dark" id="printA4">A4 Yazdır</button>
    <button class="btn btn-dark" id="printPhone">Telefon Yazdır</button>
  </div>

  <div class="hint">
    • Her Excel sheet = 1 marka<br>
    • Logo adı: <code>assets/images/&lt;sheet_adi&gt;_logo.png</code><br>
    • Excel otomatik yüklenir (manuel yükleme isteğe bağlı)
  </div>

  <div id="container"></div>
  <div id="summary" class="hint"></div>

</div>

<script>
const EXCEL_PATH = "assets/data/alternatif_urunler.xlsx";
const container = document.getElementById("container");
const summary = document.getElementById("summary");
const search = document.getElementById("search");
const fileInput = document.getElementById("file");

let allRows = [];
let allSections = [];

window.addEventListener("DOMContentLoaded", () => autoLoad());
fileInput.addEventListener("change", e => loadFile(e.target.files[0]));
search.addEventListener("input", applySearch);
document.getElementById("clear").onclick = () => { search.value=""; applySearch(); };
document.getElementById("printA4").onclick = () => window.print();
document.getElementById("printPhone").onclick = () => {
  document.body.classList.add("phonePrint");
  window.print();
  document.body.classList.remove("phonePrint");
};

function autoLoad(){
  fetch(EXCEL_PATH)
    .then(r => r.arrayBuffer())
    .then(buf => parseExcel(buf))
    .catch(() => summary.textContent="Excel otomatik yüklenemedi.");
}

function loadFile(file){
  const reader = new FileReader();
  reader.onload = e => parseExcel(e.target.result);
  reader.readAsArrayBuffer(file);
}

function parseExcel(buffer){
  container.innerHTML="";
  allRows=[]; allSections=[];
  const wb = XLSX.read(new Uint8Array(buffer), {type:"array"});
  let total=0;

  wb.SheetNames.forEach(name=>{
    const ws = wb.Sheets[name];
    const rows = XLSX.utils.sheet_to_json(ws,{header:1,defval:""});
    const headerIdx = rows.findIndex(r=>r.filter(c=>c).length>=2);
    if(headerIdx<0) return;

    const headers = rows[headerIdx];
    const data = rows.slice(headerIdx+1).filter(r=>r.some(c=>c));

    const section = document.createElement("div");
    section.className="section";

    const head = document.createElement("div");
    head.className="sectionHead";

    const left = document.createElement("div");
    left.className="sectionLeft";
    left.appendChild(makeLogo(name));
    left.appendChild(document.createTextNode(name));

    const meta = document.createElement("div");
    meta.textContent = data.length+" satır";

    head.append(left,meta);
    section.appendChild(head);

    const table=document.createElement("table");
    const thead=document.createElement("thead");
    const trh=document.createElement("tr");
    headers.forEach(h=>{const th=document.createElement("th");th.textContent=h;trh.appendChild(th);});
    thead.appendChild(trh); table.appendChild(thead);

    const tbody=document.createElement("tbody");
    data.forEach(r=>{
      const tr=document.createElement("tr");
      tr.dataset.search=(name+" "+r.join(" ")).toLowerCase();
      headers.forEach((_,i)=>{
        const td=document.createElement("td");
        td.textContent=format(r[i]);
        tr.appendChild(td);
      });
      tbody.appendChild(tr);
      allRows.push(tr);
    });

    table.appendChild(tbody);
    section.appendChild(table);
    container.appendChild(section);
    allSections.push(section);
    total+=data.length;
  });

  summary.textContent = `${wb.SheetNames.length} marka · ${total} satır`;
}

function applySearch(){
  const q=search.value.toLowerCase();
  const visible=new Set();
  allRows.forEach(r=>{
    const ok=r.dataset.search.includes(q);
    r.classList.toggle("hidden",!ok);
    if(ok) visible.add(r.closest(".section"));
  });
  allSections.forEach(s=>s.classList.toggle("hidden",!visible.has(s)));
}

function normalize(s){
  return s.toLowerCase()
    .replace(/ı/g,"i").replace(/ğ/g,"g").replace(/ü/g,"u")
    .replace(/ş/g,"s").replace(/ö/g,"o").replace(/ç/g,"c")
    .replace(/[^a-z0-9]+/g,"_").replace(/^_|_$/g,"");
}

function makeLogo(name){
  const box=document.createElement("div");
  box.className="brandLogo";
  const img=document.createElement("img");
  img.src=`assets/images/${normalize(name)}_logo.png`;
  img.onerror=()=>box.replaceWith(badge(name));
  box.appendChild(img);
  return box;
}

function badge(name){
  const b=document.createElement("div");
  b.className="brandBadge";
  b.textContent=name[0].toUpperCase();
  return b;
}

function format(v){
  if(typeof v==="number") return v.toLocaleString("tr-TR",{maximumFractionDigits:2});
  return v||"";
}
</script>
</body>
</html>
