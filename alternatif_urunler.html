<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <title>ŞENTÜRK – Diğer Markalar Fiyat Listesi</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- SheetJS -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

  <style>
    :root{
      --bg:#ececec;
      --paper:#ffffff;
      --paperBorder:#cfcfcf;
      --shadow: rgba(0,0,0,0.18);

      --text:#222;
      --muted:#6b7280;

      --btn:#111827;
      --btnText:#fff;
      --btn2:#f3f4f6;
      --btn2Text:#111827;

      --tableBorder:#dedede;
      --thead:#f2f2f2;

      --rowAlt:#f7f7f7;

      --sectionBg:#f8fafc;
      --sectionText:#111827;
    }

    *{box-sizing:border-box;margin:0;padding:0}
    body{
      font-family: system-ui,-apple-system,"Segoe UI",sans-serif;
      background: var(--bg);
      color: var(--text);
      padding: 18px;
    }

    .paper{
      max-width: 1100px;
      margin: 0 auto;
      background: var(--paper);
      border: 1px solid var(--paperBorder);
      box-shadow: 0 8px 24px var(--shadow);
      padding: 22px 26px 28px;
    }

    /* ── TOP HEADER (desktop) ───────────────────────── */
    .topbar{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:16px;
      margin-bottom: 12px;
    }

    .logoSide{
      display:flex;
      align-items:center;
      gap:10px;
      min-width: 220px;
    }
    .logoSide.right{
      justify-content:flex-end;
      text-align:right;
    }

    /* Default (left) logo size */
    .logoSide img{
      height: 64px;
      width:auto;
      object-fit:contain;
      display:block;
    }

    /* ✅ Make ONLY the top-right collage bigger on desktop */
    .logoSide.right img{
      height: 72px;
    }

    .titleWrap{
      flex: 1;
      text-align:center;
      border-top: 2px solid #333;
      padding-top: 10px;
      margin: 0 10px;
    }

    .titleWrap h1{
      font-size: 18px;
      font-weight: 800;
      letter-spacing: 0.06em;
    }

    /* removed */
    .titleWrap .sub{ display:none; }

    /* ── CONTROLS ──────────────────────────────────── */
    .controlsRow{
      display:flex;
      align-items:center;
      gap:10px;
      flex-wrap:wrap;
      margin-top: 12px;
      margin-bottom: 16px;
    }

    input[type="file"]{ font-size: 12px; }

    .search{
      padding: 8px 12px;
      border: 1px solid #cfcfcf;
      border-radius: 8px;
      min-width: 320px;
      font-size: 13px;
    }

    .btn{
      border: 1px solid #111827;
      border-radius: 8px;
      padding: 8px 12px;
      cursor:pointer;
      font-size: 13px;
      white-space:nowrap;
    }

    .btn-dark{ background: var(--btn); color: var(--btnText); }
    .btn-light{ background: var(--btn2); color: var(--btn2Text); border-color: #cfcfcf; }

    .hint{ display:none; }

    /* ── SECTIONS ──────────────────────────────────── */
    .section{
      margin-top: 16px;
      page-break-inside: avoid;
    }

    .sectionHead{
      background: var(--sectionBg);
      color: var(--sectionText);
      padding: 10px 12px;
      border-radius: 10px 10px 0 0;
      display:flex;
      justify-content:flex-start;
      align-items:center;
      gap: 12px;
      font-weight: 800;
      font-size: 14px;
      border: 1px solid var(--tableBorder);
      border-bottom: none;
    }

    .sectionLeft{
      display:flex;
      align-items:center;
      gap:12px;
      min-width: 0;
    }

    .brandLogo{
      width: 52px;
      height: 52px;
      border-radius: 12px;
      background: #fff;
      display:flex;
      align-items:center;
      justify-content:center;
      overflow:hidden;
      border: 1px solid var(--tableBorder);
      flex: 0 0 auto;
    }
    .brandLogo img{
      width: 100%;
      height: 100%;
      object-fit: contain;
      padding: 6px;
      display:block;
    }

    .brandBadge{
      width: 52px;
      height: 52px;
      border-radius: 12px;
      background: #fff;
      border: 1px solid var(--tableBorder);
      display:flex;
      align-items:center;
      justify-content:center;
      font-weight: 900;
      color: #111827;
      flex: 0 0 auto;
      font-size: 18px;
    }

    .brandName{
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      max-width: 900px;
    }

    /* ── TABLE ─────────────────────────────────────── */
    .tableWrap{
      border: 1px solid var(--tableBorder);
      border-top: none;
      overflow:auto; /* desktop ok */
      border-radius: 0 0 10px 10px;
    }

    table{
      width:100%;
      border-collapse:collapse;
      font-size: 13px;
      min-width: 820px; /* desktop style */
    }

    th, td{
      border: 1px solid var(--tableBorder);
      padding: 8px 10px;
      white-space: nowrap;
      vertical-align: top;
    }

    th{
      background: var(--thead);
      font-size: 13px;
      font-weight: 900;
      position: sticky;
      top: 0;
      z-index: 1;
    }

    tbody tr:nth-child(even){ background: var(--rowAlt); }
    .hidden{ display:none !important; }

    .hide-mobile{ }

    /* ─────────────────────────────────────────────
       MOBILE: Option A header + fit table to screen
       ───────────────────────────────────────────── */
    @media (max-width: 760px){
      body{ padding: 10px; }
      .paper{ padding: 14px 12px 16px; }

      .topbar{
        flex-direction: column;
        align-items: center;
        gap: 14px;
      }

      .logoSide{
        min-width: 0;
        width: 100%;
        justify-content: center;
      }

      /* keep Şentürk as before */
      .logoSide img{
        height: 72px;
      }

      .titleWrap{
        width: 100%;
        text-align: center;
        border-top: none;
        padding-top: 0;
        margin: 0;
      }

      .titleWrap h1{
        font-size: 18px;
        line-height: 1.25;
      }

      .logoSide.right{
        width: 100%;
        justify-content: center;
      }

      /* ✅ Make ONLY the collage logo bigger on mobile */
      .logoSide.right img{
        height: 56px;
      }

      .controlsRow{ gap: 8px; }
      .search{ min-width: 100%; flex: 1 1 100%; }
      input[type="file"]{ width: 100%; }
      .btn{ flex: 1 1 auto; }

      .brandLogo, .brandBadge{
        width: 56px;
        height: 56px;
        border-radius: 14px;
      }
      .brandLogo img{ padding: 7px; }

      .tableWrap{ overflow: hidden; }

      table{
        min-width: 0;
        width: 100%;
        table-layout: fixed;
        font-size: 12.5px;
      }

      th, td{
        white-space: normal;
        word-break: break-word;
        overflow-wrap: anywhere;
        padding: 7px 8px;
      }

      .hide-mobile{ display:none !important; }
    }

    @media print{
      body{ background:#fff; padding:0 }
      .paper{ box-shadow:none; border:none; padding:10mm; }
      .controlsRow{ display:none }
      table{ min-width:auto; table-layout:auto; }
      th{ position:static }
      td,th{ white-space:normal }
    }
  </style>
</head>

<body>
<div class="paper">

  <div class="topbar">
    <div class="logoSide">
      <img src="assets/images/senturk_logo.png" alt="Şentürk">
    </div>

    <div class="titleWrap">
      <h1>DİĞER MARKALAR FİYAT LİSTESİ</h1>
    </div>

    <div class="logoSide right">
      <img src="assets/images/alt_toplu_logo.png" alt="" onerror="this.style.display='none'">
    </div>
  </div>

  <div class="controlsRow">
    <input type="file" id="file" accept=".xlsx,.xls">
    <input class="search" id="search" placeholder="Ürün / ambalaj / fiyat ara...">
    <button class="btn btn-light" id="clear">Temizle</button>
    <button class="btn btn-dark" id="printA4">A4 Yazdır</button>
    <button class="btn btn-dark" id="printPhone">Telefon Yazdır</button>
  </div>

  <div id="container"></div>
  <div id="summary" style="display:none;"></div>

</div>

<script>
const EXCEL_PATH = "assets/data/alternatif_urunler.xlsx";
const container = document.getElementById("container");
const search = document.getElementById("search");
const fileInput = document.getElementById("file");

let allRows = [];
let allSections = [];

window.addEventListener("DOMContentLoaded", () => autoLoad());
fileInput.addEventListener("change", e => loadFile(e.target.files[0]));
search.addEventListener("input", applySearch);
document.getElementById("clear").onclick = () => { search.value=""; applySearch(); };
document.getElementById("printA4").onclick = () => window.print();
document.getElementById("printPhone").onclick = () => window.print();

function autoLoad(){
  fetch(EXCEL_PATH)
    .then(r => {
      if (!r.ok) throw new Error("Excel not found: " + EXCEL_PATH);
      return r.arrayBuffer();
    })
    .then(buf => parseExcel(buf))
    .catch(() => { /* silent */ });
}

function loadFile(file){
  if (!file) return;
  const reader = new FileReader();
  reader.onload = e => parseExcel(e.target.result);
  reader.readAsArrayBuffer(file);
}

function isBlank(v){ return String(v ?? "").trim() === ""; }

function normalizeForLogo(s){
  return String(s || "")
    .toLowerCase()
    .replace(/ı/g,"i").replace(/ğ/g,"g").replace(/ü/g,"u")
    .replace(/ş/g,"s").replace(/ö/g,"o").replace(/ç/g,"c")
    .replace(/[^a-z0-9]+/g,"_")
    .replace(/^_+|_+$/g,"");
}

function headerNorm(h){
  return String(h || "")
    .toLowerCase()
    .replace(/ı/g,"i").replace(/ğ/g,"g").replace(/ü/g,"u")
    .replace(/ş/g,"s").replace(/ö/g,"o").replace(/ç/g,"c")
    .replace(/\s+/g,"")
    .trim();
}

function isBrandHeader(h){
  const n = headerNorm(h);
  return n.includes("urunmarkasi") || n === "marka" || (n.includes("marka") && !n.includes("ambalaj"));
}

function detectCarryColumns(headers){
  const carry = [];
  headers.forEach((h, i) => {
    const n = headerNorm(h);
    if (
      n.includes("urunmarkasi") || n.includes("marka") ||
      n === "urun" || n.includes("urunadi") ||
      n.includes("aciklama") || n.includes("açiklama") ||
      n.includes("kod")
    ) carry.push(i);
  });
  if (carry.length === 0 && headers.length) carry.push(0);
  return Array.from(new Set(carry));
}

function forwardFill(rows, carryIdxs){
  const last = {};
  return rows.map(r => {
    const row = r.slice();
    carryIdxs.forEach(idx => {
      if (isBlank(row[idx]) && last[idx] !== undefined) row[idx] = last[idx];
      if (!isBlank(row[idx])) last[idx] = row[idx];
    });
    return row;
  });
}

function format(v){
  if (typeof v === "number") {
    const rounded = Math.round((v + Number.EPSILON) * 100) / 100;
    return rounded.toLocaleString("tr-TR", { maximumFractionDigits: 2 });
  }
  const s = String(v ?? "").trim();
  if (s && /^-?\d+(\.\d+)?$/.test(s) && s.length > 10) {
    const num = Number(s);
    if (!Number.isNaN(num)) return format(num);
  }
  return s;
}

function makeLogo(sheetName){
  const box = document.createElement("div");
  box.className = "brandLogo";
  const img = document.createElement("img");
  img.alt = sheetName + " logo";
  img.src = `assets/images/${normalizeForLogo(sheetName)}_logo.png`;
  img.onerror = () => box.replaceWith(makeBadge(sheetName));
  box.appendChild(img);
  return box;
}

function makeBadge(sheetName){
  const b = document.createElement("div");
  b.className = "brandBadge";
  const t = String(sheetName || "").trim();
  b.textContent = t ? t[0].toUpperCase() : "?";
  return b;
}

function parseExcel(buffer){
  container.innerHTML="";
  allRows=[]; allSections=[];

  const wb = XLSX.read(new Uint8Array(buffer), {type:"array"});

  wb.SheetNames.forEach(sheetName=>{
    const ws = wb.Sheets[sheetName];
    const rows = XLSX.utils.sheet_to_json(ws,{header:1,raw:true,defval:""});

    const headerIdx = rows.findIndex(r => r.filter(c => !isBlank(c)).length >= 2);
    if (headerIdx < 0) return;

    const headers = rows[headerIdx].map(h => String(h ?? "").trim());
    let data = rows.slice(headerIdx+1).filter(r => r.some(c => !isBlank(c)));
    if (!data.length) return;

    const carryIdxs = detectCarryColumns(headers);
    data = forwardFill(data, carryIdxs);

    const section = document.createElement("div");
    section.className="section";

    const head = document.createElement("div");
    head.className="sectionHead";

    const left = document.createElement("div");
    left.className="sectionLeft";
    left.appendChild(makeLogo(sheetName));

    const nameEl = document.createElement("div");
    nameEl.className = "brandName";
    nameEl.textContent = sheetName;
    left.appendChild(nameEl);

    head.appendChild(left);
    section.appendChild(head);

    const wrap = document.createElement("div");
    wrap.className = "tableWrap";

    const table = document.createElement("table");

    const thead = document.createElement("thead");
    const trh = document.createElement("tr");
    headers.forEach(h=>{
      const th = document.createElement("th");
      th.textContent = h;
      if (isBrandHeader(h)) th.classList.add("hide-mobile");
      trh.appendChild(th);
    });
    thead.appendChild(trh);
    table.appendChild(thead);

    const tbody = document.createElement("tbody");
    data.forEach(r=>{
      const tr = document.createElement("tr");
      tr.dataset.search = (sheetName+" "+r.map(format).join(" ")).toLowerCase();

      headers.forEach((h,i)=>{
        const td = document.createElement("td");
        td.textContent = format(r[i]);
        if (isBrandHeader(h)) td.classList.add("hide-mobile");
        tr.appendChild(td);
      });

      tbody.appendChild(tr);
      allRows.push(tr);
    });

    table.appendChild(tbody);
    wrap.appendChild(table);
    section.appendChild(wrap);
    container.appendChild(section);
    allSections.push(section);
  });

  applySearch();
}

function applySearch(){
  const q = search.value.trim().toLowerCase();
  if (!q) {
    allRows.forEach(r => r.classList.remove("hidden"));
    allSections.forEach(s => s.classList.remove("hidden"));
    return;
  }
  const visible = new Set();
  allRows.forEach(r=>{
    const ok = r.dataset.search.includes(q);
    r.classList.toggle("hidden", !ok);
    if (ok) visible.add(r.closest(".section"));
  });
  allSections.forEach(s => s.classList.toggle("hidden", !visible.has(s)));
}
</script>
</body>
</html>
