<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <title>STARGILL Fiyat Listesi</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <style>
    :root{
      --senturk-navy:#1b2533;
      --border-light:#dcdcdc;
      --bg-light:#f7f7f7;
      --footer-bordo:#7b1f22;
    }

    body{
      margin:0;
      padding:24px;
      background:#e6e6e6;
      font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI","Helvetica Neue",Arial,"Noto Sans",sans-serif;
      color:#111;
    }

    .page{
      max-width:1100px;
      margin:auto;
      background:#fff;
      padding:24px 32px 32px;
      box-shadow:0 0 12px rgba(0,0,0,0.12);
    }

    /* HEADER */
    .header{
      display:flex;
      justify-content:space-between;
      align-items:flex-end;
      margin-bottom:12px;
    }
    .senturk-logo img{ height:50px; }
    .brand-logo img{ height:50px; }

    /* SUBHEADER */
    .subheader{
      margin-top:6px;
      padding-top:8px;
      margin-bottom:10px;
      border-top:1px solid #000;
      font-weight:800;
      text-align:center;
      color:var(--senturk-navy);
    }
    .editable-title{
      display:inline-block;
      padding:0 4px;
      border-bottom:1px dashed #ccc;
    }

    /* TOOLBAR */
    .toolbar{
      display:flex;
      justify-content:space-between;
      gap:8px;
      flex-wrap:wrap;
      margin-bottom:12px;
      font-size:13px;
    }
    .toolbar-left,.toolbar-right{
      display:flex;
      gap:8px;
      flex-wrap:wrap;
    }
    input[type="file"], #searchInput{
      padding:4px 8px;
      border:1px solid #ccc;
      border-radius:4px;
      font-size:12px;
    }
    .toolbar button{
      padding:6px 10px;
      border-radius:4px;
      border:none;
      background:var(--senturk-navy);
      color:#fff;
      font-size:12px;
      cursor:pointer;
    }

    /* CONTENT */
    #content{
      column-count:2;
      column-gap:16px;
    }
    @media (max-width:1200px){
      #content{ column-count:1; }
    }
    .group-block{
      break-inside:avoid;
      page-break-inside:avoid;
      margin-bottom:14px;
    }

    /* TABLE */
    table.section-matrix{
      width:100%;
      border-collapse:collapse;
      table-layout:fixed;
      font-size:11px;
    }
    th, td{
      border:1px solid var(--border-light);
      padding:6px;
      text-align:center;
      vertical-align:middle;
    }
    th{
      background:var(--bg-light);
      font-weight:900;
      font-size:10px;
    }

    td.section-name{
      font-weight:900;
      background:#fff;
      word-break:break-word;
    }

    td.nowrap{
      white-space:nowrap;
      font-variant-numeric:tabular-nums;
    }

    td.sec-desc{
      word-break:break-word;
    }

    td.sec-price{ font-weight:900; }

    .h-short{ display:none; }

    /* FOOTER */
    .footer{
      margin-top:18px;
      padding-top:8px;
      border-top:4px solid var(--footer-bordo);
      font-size:11px;
      color:var(--footer-bordo);
      text-align:center;
    }

    /* ==========================================================
       PRINT
       ========================================================== */
    @media print{
      body{ background:#fff; margin:0; padding:0; }
      .page{ box-shadow:none; padding:8mm 6mm; }
      .toolbar{ display:none; }

      /* default print = portrait, 1 column */
      #content{ column-count:1; }

      .h-long{ display:none; }
      .h-short{ display:inline; }

      table.section-matrix{ font-size:9px; }
      th, td{ padding:1.6mm 1.2mm; }

      table, th, td{ border-color:#000; }

      .group-block, table, tr, td{ page-break-inside:avoid; }

      /* LANDSCAPE */
      body.landscape-print #content{
        column-count:2;
        column-gap:7mm;
      }
      body.landscape-print @page{
        size:A4 landscape;
      }

      /* BLACK & WHITE (DEFAULT = LANDSCAPE + 2 COLS) */
      body.bw-print{
        color:#000;
      }
      body.bw-print *{
        color:#000 !important;
        background:#fff !important;
        box-shadow:none !important;
      }
      body.bw-print #content{
        column-count:2 !important;
        column-gap:7mm !important;
      }
      body.bw-print @page{
        size:A4 landscape;
      }
      body.bw-print .footer{
        border-top:2px solid #000;
      }
    }
  </style>

  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
</head>

<body>
<div class="page">

  <div class="header">
    <div class="senturk-logo">
      <img src="assets/images/senturk_logo.png">
    </div>
    <div class="brand-logo">
      <img src="assets/images/stargill_logo.png">
    </div>
  </div>

  <div class="subheader">
    <span class="editable-title">STARGIL FİYAT LİSTESİ</span>
    &nbsp;–&nbsp;
    <span id="monthLabel" class="editable-title"></span>
  </div>

  <div class="toolbar">
    <div class="toolbar-left">
      <input type="file" id="excelInput" accept=".xlsx,.xls">
    </div>
    <div class="toolbar-right">
      <input type="text" id="searchInput" placeholder="Ara...">
      <button onclick="printPortrait()">A4 / Dikey</button>
      <button onclick="printLandscape()">A4 / Yatay</button>
      <button onclick="printBW()">Siyah Beyaz Yazdır</button>
    </div>
  </div>

  <div id="content"></div>

  <div class="footer">
    <div class="line">
      Şentürk Boya İnş. Tur. San. Tic. Ltd. Şti. &nbsp;&nbsp;
      Adres : Petrol İş Mah. Kızılay Bulvarı Efe Sok. No:4 Toprakyol Kartal / İstanbul
    </div>
    <div class="line">
      Telefon: 0216 - 473 78 90 &nbsp;&nbsp;&nbsp;
      Fax : 0216 - 473 78 93 &nbsp;&nbsp;&nbsp;
      info@senturkboya.com
    </div>
  </div>

</div>

<script>
/* ================= CONFIG ================= */
const DEFAULT_EXCEL_PATH="assets/data/stargill_fiyat.xlsx";

/* ================= HELPERS ================= */
const isBlank=v=>v==null||String(v).trim()==="";
const isBlankRow=r=>r.every(isBlank);

function fmt(val){
  if(val==null) return "";
  let n=parseFloat(String(val).replace(",","."));
  if(isNaN(n)) return val;
  return n.toLocaleString("tr-TR",{minimumFractionDigits:2});
}
function fmtCode(v){
  if(typeof v==="number") return String(v).padStart(5,"0");
  return v;
}

/* ================= PRINT ================= */
function clearPrint(){
  document.body.classList.remove("bw-print","landscape-print");
}
function printPortrait(){
  clearPrint(); window.print();
}
function printLandscape(){
  clearPrint(); document.body.classList.add("landscape-print"); window.print();
}
function printBW(){
  clearPrint();
  document.body.classList.add("bw-print","landscape-print"); // ✅ DEFAULT
  window.print();
}
window.onafterprint=clearPrint;

/* ================= RENDER ================= */
function renderAOA(aoa){
  let html="", i=0;
  while(i<aoa.length){
    if(aoa[i].some(c=>String(c).toLowerCase().includes("kod"))){
      let section="", items=[];
      let header=aoa[i]; i++;
      while(i<aoa.length&&!isBlankRow(aoa[i])){
        let r=aoa[i];
        if(r[0]) section=r[0];
        if(r[1]){
          items.push({
            code:fmtCode(r[1]),
            desc:r[2]||"",
            ebat:r[3],
            fiyat:r[4],
            kdv:r[5]
          });
        }
        i++;
      }
      if(items.length){
        html+=`<div class="group-block"><table class="section-matrix">
        <thead><tr>
          <th></th><th>Kod</th>
          ${items[0].desc?'<th>Açıklama</th>':''}
          <th>Ebat</th><th>Fiyat</th><th>KDV</th>
        </tr></thead><tbody>`;
        items.forEach((it,idx)=>{
          html+=`<tr>`;
          if(idx===0) html+=`<td class="section-name" rowspan="${items.length}">${section}</td>`;
          html+=`<td class="nowrap">${it.code}</td>`;
          if(it.desc) html+=`<td class="sec-desc">${it.desc}</td>`;
          html+=`<td class="nowrap">${it.ebat}</td>
                 <td class="nowrap sec-price">${fmt(it.fiyat)}</td>
                 <td class="nowrap sec-price">${fmt(it.kdv)}</td></tr>`;
        });
        html+=`</tbody></table></div>`;
      }
    }
    i++;
  }
  document.getElementById("content").innerHTML=html;
}

/* ================= LOAD ================= */
function loadExcel(buf){
  let wb=XLSX.read(buf,{type:"array"});
  let ws=wb.Sheets[wb.SheetNames[0]];
  renderAOA(XLSX.utils.sheet_to_json(ws,{header:1,defval:""}));
}

document.getElementById("excelInput").onchange=e=>{
  let f=e.target.files[0];
  if(!f) return;
  let r=new FileReader();
  r.onload=ev=>loadExcel(ev.target.result);
  r.readAsArrayBuffer(f);
};

fetch(DEFAULT_EXCEL_PATH)
  .then(r=>r.arrayBuffer())
  .then(loadExcel);

/* ================= INIT ================= */
const m=["OCAK","ŞUBAT","MART","NİSAN","MAYIS","HAZİRAN","TEMMUZ","AĞUSTOS","EYLÜL","EKİM","KASIM","ARALIK"];
document.getElementById("monthLabel").textContent=
  m[new Date().getMonth()]+" "+new Date().getFullYear();
</script>
</body>
</html>
